{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}Blog Dashboard — Create Post{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6">
  <div class="flex flex-col md:flex-row gap-6">
    <!-- Left: Form -->
    <div class="w-full md:w-2/3 bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-6 shadow-lg tilt-card">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-semibold text-primary">Create New Post</h2>
        <a href="{% url 'dashboard_blog_list' %}" class="text-sm text-secondary hover:text-primary">← Back to posts</a>
      </div>

      <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div class="grid grid-cols-1 gap-4">
          <!-- title -->
          <div>
            {{ form.title.label_tag }}
            {{ form.title }}
            {{ form.title.errors }}
          </div>

          <!-- author & status -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              {{ form.author.label_tag }}
              {{ form.author }}
              {{ form.author.errors }}
            </div>
            <div>
              {{ form.status.label_tag }}
              {{ form.status }}
              {{ form.status.errors }}
            </div>
          </div>

          <!-- image -->
          <div>
            {{ form.image.label_tag }}
            {{ form.image }}
            {{ form.image.errors }}
          </div>

          <!-- meta & keywords -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              {{ form.meta_description.label_tag }}
              {{ form.meta_description }}
              {{ form.meta_description.errors }}
            </div>
            <div>
              {{ form.keywords.label_tag }}
              {{ form.keywords }}
              {{ form.keywords.errors }}
              <p class="text-xs text-secondary/70 mt-1">comma separated</p>
            </div>
          </div>

          <!-- content -->
          <div>
            {{ form.content.label_tag }}
            {{ form.content }}
            {{ form.content.errors }}
            <p class="text-xs text-secondary/70 mt-1">Tip: Use a rich editor (see dashboard docs).</p>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <button type="submit" class="bg-gradient-to-r from-primary to-accent text-background font-semibold px-5 py-2 rounded-md hover:brightness-110 transition">
            Save Post
          </button>

          <a href="{% url 'dashboard_blog_list' %}" class="text-secondary hover:text-primary">Cancel</a>
        </div>
      </form>
    </div>

    <!-- Right: Quick list / drafts -->
    <aside class="w-full md:w-1/3">
      <div class="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-4 shadow-lg">
        <h3 class="text-lg font-semibold text-primary mb-3">Recent Posts</h3>

        <ul class="space-y-3 max-h-96 overflow-auto">
          {% for p in recent_posts %}
          <li class="flex items-start justify-between gap-3 p-2 rounded-md hover:bg-white/3 transition">
            <div class="flex-1 min-w-0">
              <a href="{% url 'dashboard_blog_edit' p.id %}" class="font-medium text-secondary truncate block">{{ p.title }}</a>
              <div class="text-xs text-secondary/70"> {{ p.published_at|default:p.created_at|date:"M d, Y" }} • {{ p.status }}</div>
            </div>
            <div class="flex flex-col items-end">
              <a href="{% url 'blog_detail' p.slug %}" target="_blank" class="text-sm text-cyan-300 hover:underline">View</a>
              <a href="{% url 'dashboard_blog_delete' p.id %}" class="text-sm text-red-400 hover:text-red-500 mt-2 js-delete-link">Delete</a>
            </div>
          </li>
          {% empty %}
          <li class="text-secondary/60">No posts yet</li>
          {% endfor %}
        </ul>
      </div>
    </aside>
  </div>
</div>

<script>
  // simple delete confirmation
  document.querySelectorAll('.js-delete-link').forEach(a => {
    a.addEventListener('click', function (e) {
      if (!confirm('Delete this post? This action cannot be undone.')) {
        e.preventDefault();
      }
    });
  });
</script>
{% endblock %}
